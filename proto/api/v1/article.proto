syntax = "proto3";
package fifsky.blog.api.v1;

import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "google/protobuf/empty.proto";
import "google/api/httpbody.proto";
import "buf/validate/validate.proto";
import "api/v1/common.proto";

option go_package = "gen/api/v1";

service ArticleService {
  rpc Archive(google.protobuf.Empty) returns (ArchiveResponse) {
    option (google.api.http) = {
      post: "/api/article/archive"
      body: "*"
    };
  }
  rpc List(ArticleListRequest) returns (ArticleListResponse) {
    option (google.api.http) = {
      post: "/api/article/list"
      body: "*"
    };
  }
  rpc PrevNext(PrevNextRequest) returns (PrevNextResponse) {
    option (google.api.http) = {
      post: "/api/article/prevnext"
      body: "*"
    };
  }
  rpc Detail(ArticleDetailRequest) returns (ArticleItem) {
    option (google.api.http) = {
      post: "/api/article/detail"
      body: "*"
    };
  }
  rpc Feed(google.protobuf.Empty) returns (google.api.HttpBody) {
    option (google.api.http) = {
      get: "/feed.xml"
    };
  }
}

message ArchiveResponse {
  repeated DateArchiveItem list = 1;
}
message DateArchiveItem {
  string url = 1;
  string content = 2;
}

message ArticleListRequest {
  string year = 1;
  string month = 2;
  string domain = 3;
  string keyword = 4;
  int32 page = 5;
  int32 type = 6;
}

message ArticleItem {
  int32 id = 1;
  int32 cate_id = 2;
  int32 type = 3;
  int32 user_id = 4;
  string title = 5;
  string url = 6;
  string content = 7;
  int32 status = 8;
  string created_at = 9;
  string updated_at = 10;
  UserSummary user = 11;
  CateSummary cate = 12;
}

message ArticleListResponse {
  repeated ArticleItem list = 1;
  int32 page_total = 2;
}

message PrevNextRequest {
  int32 id = 1[
    (buf.validate.field).int32.gt = 0,
    (google.api.field_behavior) = REQUIRED
  ];
}
message PrevNextItem {
  int32 id = 1;
  string title = 2;
}
message PrevNextResponse {
  PrevNextItem prev = 1;
  PrevNextItem next = 2;
}

message ArticleDetailRequest {
  int32 id = 1[
    (buf.validate.field).int32.gt = 0
  ];
  string url = 2;

  option (buf.validate.message).oneof = {
    // At most one search method can be used
    fields: ["id", "url"],
    // One search method must be present
    required: true
  };
}
